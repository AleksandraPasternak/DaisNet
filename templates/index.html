{% extends "base.html" %} {% block content %}

<div id="page-overlay">
    <div id="popup">
        <div class="blur-sigma" style="width: 800px;">
            <div class="gauss-fourier" style="float: left; width: 320px;">
                <input type="button" value="-" class="minus-blur" data-field="quantity_blur">
                <input id="blur" type="number" step="1" max="" value="0" name="quantity_blur" class="quantity-field" disabled>
                <input type="button" value="+" class="plus-blur" data-field="quantity_blur">
                <input type="button" value="-" class="minus-fourier" data-field="quantity_fourier">
                <input id="fourier" type="number" step="1" max="" value="0" name="quantity_fourier" class="quantity-field" disabled>
                <input type="button" value="+" class="plus-fourier" data-field="quantity_fourier">
            </div>
            <div class="custom-switch" style="float: left; width: 120px;">
                <input type="checkbox" class="custom-control-input" id="grayscale">
                <label class="custom-control-label" for="grayscale">Grayscale</label>
            </div>
            <div class="custom-switch" style="float: left; width: 120px;">
                <input type="checkbox" class="custom-control-input" id="sharpen">
                <label class="custom-control-label" for="sharpen">Sharpen</label>
            </div>
            <div class="custom-switch" style="float: left; width: 120px;">
                <input type="checkbox" class="custom-control-input" id="contour">
                <label class="custom-control-label" for="contour">Contour</label>
            </div>
            <div class="reset-button" style="float: left; width: 120px;">
                <button class="btn" id="reset">Reset</button>
            </div>
        </div>
        <div class="tools">
            <span><label>Gaussian blur</label></span>
            <span><label>Fourier</label></span>
        </div>
        <div class="crop-wrapper">
            <div class="loader" id="loader-blur" style="display:none;"></div>
            <div class="overlay">
                <div class="overlay-inner"> </div>
            </div>
            <img class="resize-image" src="" alt="Resizable image" id="resized-image">
        </div>
        <div id="tools-description">
            <p>Your photo must fit the gray frame</p>
        </div>
        <button class="btn" id="crop_save">Crop & Save</button>
    </div>
</div>

<div id="page-header">
    <div class="description-section">
        <h2>Image Classifier</h2>
        <p>This site allows you to upload your DAIS' photo in order to predict whether the airplane's surface is corroded.</p>
    </div>
    <div id="button-about-section">
        <button type="button" class="btn" id="btn-about">About classifier</button>
    </div>
    <div id="button-back-section">
        <button type="button" class="btn" id="btn-back">Back to classifier</button>
    </div>
</div>
<div id="main-page">
    <div class="uploading-result-section">
        <form id="upload-file">
            <label for="imageUpload" class="upload-label">
                Upload photo
            </label>
            <input type="file" name="file" id="imageUpload" accept=".bmp, .png, .jpg, .jpeg">
        </form>

        <div class="image-section" style="display:none;">
            <div class="img-preview">
                <div id="imagePreview"> </div>
            </div>
            <div>
                <button type="button" class="btn" id="btn-predict">Predict</button>
            </div>
        </div>

        <div class="loader" id="loader1" style="display:none;"></div>

        <h3 id="result">
            <span> </span>
        </h3>
        <div class="gradcam-section" style="display:none;">
            <button type="button" class="btn" id="btn-gradcam">More...</button>
            <div class="loader" id="loader2" style="display:none;"></div>
            <div class="gradcam-preview">
                <p>Heatmap showing which pixels were responsible for prediction:</p>
                <div id="gradcamPreview">
                    <img id="gradcamOutput">
                </div>
            </div>
        </div>
    </div>
    <div class="about-network-section">
        <h4>About classifier</h4>
        <p align="justify">Image classifier used by this site is based on EfficientNetB0 architecture (without top layers)
            with following GlobalAveragePooling and Dense layers. </p>
        <!--<img src="/static/default_pictures/inception-architecture.png" alt="Inception architecture" width=90%>-->
        <p align="justify">The classifier was trained on images obtained from D-Sight Aircraft Inspection System (DAIS)
            - examples of these images can be found on the right side of this site. Dataset contained 10343 training
            images, 1448 validation images and 1284 test images split into 2 classes: corrosion - no corrosion
            (corrosion class contained images featuring 4 levels of damages: soft, medium and hard corrosion and soft
            damage). </p>
        <p align="justify">Dataset preprocessing included feature-wise standardization. During training, data augmentation
            including horizontal and vertical flips was used.</p>
        <p align="justify">Classifier achieved 75% accuracy on test set with 73% precision and 89% recall.
            Threshold above which images were classified as corroded was adjusted in order to minimize number of photos
            incorrectly classified as not corroded (false negatives) - as this case is crucial for safety of inspected
            machine's passengers - paying attention not to significantly decrease classifier's accuracy. </p>
        <p align="justify">Classifier's output shows not only label predicted by network, but also probabilities of each
            class (first value - no corrosion, second value - corrosion) which can be useful for professionals using
            this site in deciding whether the image should be further analyzed or not.</p>
    </div>
    <div class="recent-photos">
        <div class="gallery">
            <img src="/static/default_pictures/010A0012_0_0_0.BMP" alt="plane 1">
        </div>
        <div class="gallery">
            <img src="/static/default_pictures/010B0001_0_0_0.BMP" alt="plane 2">
        </div>
        <div class="gallery">
            <img src="/static/default_pictures/010D0013_1_0_0.BMP" alt="plane 3">
        </div>
    </div>

</div>

{% endblock %}
